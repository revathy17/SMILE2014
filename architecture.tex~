
\section{Methods}
\label{sec:Methods}

There are three sub tasks accomplished in the system \begin{inparaenum}[(1)]
 	\item \textit{Temporal Expression Extraction} 
 	\item \textit{Normalization}
 	\item \textit{Association of Medical Concepts with Temporal Expression}
\end{inparaenum}

\subsection{Temporal Expression Extraction}
The existing ezDI modules are used to process the clinical documents and 	split them into sentences. These sentences are parsed and the chunker output is classified as either a temporal expression or not by a classifier. The chunks used are NP, ADVP, ADJP and QP.

Following features are extracted from each of the phrase (Binary output 0/1): 
\begin{enumerate}
\item 1 if the phrase contains a day of the week like \textit{Sunday}, \textit{Monday} etc, 0 otherwise.
\item 1 if the phrase contains a month of the year like \textit{January}, \textit{February} etc, 0 otherwise.
\item 1 if the phrase contains numbers in words like \textit{one}, \textit{two} etc, 0 otherwise.
\item 1 if the phrase contains a duration like \textit{month}, \textit{months}, \textit{weeks} etc, 0 otherwise.
\item 1 if the phrase contains a time of the day like  \textit{afternoon}, \textit{evening} etc, 0 otherwise.
\item 1 if the phrase contains a time unit like \textit{AM}, \textit{PM} etc, 0 otherwise.
\item 1 if the phrase contains a date pattern like \textit{X/X/X}, \textit{X/X} , \textit{X-X-X} etc, 0 otherwise.
\item 1 if the phrase contains a time pattern like \textit{:}, 0 otherwise.
\end{enumerate}

The training dataset was created from the I2B2 dataset of 2011 which 	contained a variety of temporal expressions. This would also ensure that the 	classifier was not over-fitted for the ezDI dataset. The training dataset has 	235 “DATE” expressions, 54 “RDT” expressions, 198 “DURATION” expressions,  25 	“RT” expressions and 9 “TIME” expressions. 

A Random Forest Classifier \cite{breiman2001random} was trained on this dataset. A Random Forest classifier grows many classification trees. To classify an unlabeled instance, it is passed through each of the classification tree and the 	forest chooses the classification that was chosen by the maximum number of trees in the forest. The Weka implementation of this classifier \cite{hall2009weka} was used. 

Figure 1 illustrates the input and output to the Temporal Expression Extraction module.

\begin{figure}[t!]
\centering
\includegraphics[width = 10.0 cm]{./images/TE_Extraction.png}
%\vspace*{-0.75em}
\caption{Temporal Expression Extraction}
\label{fig:TE_Extraction}
\end{figure}


\subsection{Normalization}
Normalization is the task of representing the extracted temporal expression 	in a standard form. For example \textit{3 months ago} does not, in itself, provide information about the exact time referred to, in the document. Given that the document was written on \textit{15-July-2013}, we can say that \textit{3 months ago} implies 	\textit{April-2013}
	
For the task of Normalization, an open source tool called TIMEN \cite{llorens2012timen} was used. TIMEN is a rule based system and builds on all the prior rule based systems developed for the task of normalization. The rules are stored in a SQLite database and can be easily modified or updated as per our requirements. 

\subsection{Association}
The next important issue addressed in this system is that of identification of association between a medical concept and temporal expression. In a sentence with 	multiple temporal expressions, disambiguating which temporal expression is related to which medical concept is crucial. For example in the sentence \textit{Ischemic cardiomyopathy, recent decompensated heart failure in September 2010, previous bypass surgery in 	2007, and drop in ejection fraction, now at the 35\% range},  \textbf{heart failure} was in \textbf{September 2010} (as opposed to 2007) and \textbf{bypass surgery} was in \textbf{2007}.
	
	To identify such associations, we use the dependency relationship between words. The stanford typed 	dependencies provides a simple description of the grammatical relationships in a sentence \cite{de2008stanford}. Fei et al. proposed an approach to mine dependency relationships for determining the targets of sentiment expressions in a sentence \cite{fei2006mining}. We use these rules to determine the relationship between a temporal expression and a medical concept.
	

\begin{figure}[t!]
\centering
\includegraphics[width = 10.0 cm]{./images/Association.png}
%\vspace*{-0.75em}
\caption{Association between Medical Concepts and Temporal Expression}
\label{fig:Association}
\end{figure}

\begin{enumerate}
\item \textbf{Direct Relationship between Medical Concept and Temporal Expression} \\
Consider the example \textit{He had an aortic valvular replacement in 1998, but he had normal coronary arteries at that time}. Here there is a dependency relationship between \textit{replacement} and \textit{1998} as
\begin{center}
prep\_in(replacement-6, 1998-8) \\
\end{center}
\item \textbf{Temporal Expression and Medical Concept are in the different children of the same ancestor} \\
Consider the example \textit{We will schedule CT angiography over the next week or so and follow up with me in about two weeks}. Here \textit{angiography} and \textit{week} have the same ancestor \textit{schedule}.


\begin{quote}
	\hspace{27 mm} advmod(schedule-3, angiography-5) \\
	\hspace*{27 mm} prep\_over(schedule-3, week-9) \\
\end{quote}


\item \textbf{Medical Concept is in the ancestor of Temporal Expression or vice versa} \\
Consider the example \textit{The patient s ejection fraction by echocardiogram done in September of this year is within normal limits}. Here \textit{echocardiogram} is in the ancestor of \textit{September}.

\begin{quote}
\hspace{27 mm} partmod(echocardiogram-7, done-8) \\
\hspace*{27 mm} prep\_in(done-8, September-10) \\
\end{quote}
\end{enumerate}

Apart from these three dependencies, we also experimented with indirect associations - if we are not able to establish the relationship between a medical concept and a temporal expression, we see if the medical concept in question is associated to any other medical concepts in the sentence which in turn has a relationship to the temporal expression. For instance in \textit{Gangrene of left second toe in 2010-06-06 followed by an amputation}, even though we do not see a dependency relationship between \textit{amputation} and \textit{2010-06-06}, since there is a dependency between \textit{Gangrene} and \textit{2010-06-06} and a dependency relationship between \textit{amputation} and \textit{Gangrene}, we can conclude that both the medical concepts are associated with the date.

\begin{quote}
\hspace{35 mm} prep\_of(Gangrene-1, toe-5) \\
\hspace*{35 mm} prep\_in(toe-5, 2010-06-06-7) \\
\hspace*{35 mm} nsubj(followed-8, Gangrene-1) \\
\hspace*{35 mm} prep\_by(followed-8, amputation-11) \\
\end{quote}

The best results were achieved by using default association for sentences that contained a single temporal expression. In such sentences, we assume that all the medical concepts in that sentence are talked about, in the same context as the date. In sentences containing more than one temporal expression, we applied the above dependency rules in that order.
